# PDF报告导出功能使用说明

## 功能概述

系统已实现专业的"空天地一体化碳汇监测报告"PDF导出功能，报告格式符合您提供的模板要求。

## 使用方法

1. **进入监测区详情页面**
   - 在Dashboard中选择一个监测区
   - 点击进入详情页面

2. **导出PDF报告**
   - 点击页面右上角的"导出PDF"按钮
   - 系统会自动生成报告数据并导出PDF文件
   - 文件名格式：`空天地一体化碳汇监测报告-{监测区名称}-{日期}.pdf`

## 报告内容

报告包含以下章节：

### 一、监测概述
- **1.1 执行摘要**：碳汇总量、植被健康、经济价值等核心指标
- **1.2 项目与监测区概况**：项目基本信息表格
- **1.3 监测方法与技术**：空天地一体化技术说明

### 二、核心计量结果
- **2.1 碳汇量评估**：固碳总量、单位面积碳汇量等数据表格
- **2.2 植被状况动态分析**：NDVI趋势分析摘要
- **2.3 数据质量与说明**：数据来源、不确定性说明等

### 三、结论与建议
- 监测期表现总结
- 持续监测、经营管理、价值实现等建议

## 数据自动计算

系统会自动计算以下数据：

- **碳汇总量**：从监测区累计数据获取
- **单位面积碳汇量**：自动转换为亩单位
- **等效车辆数**：基于碳汇总量计算（假设每辆车年排放2.4吨CO2）
- **经济价值**：基于当前碳价计算
- **NDVI统计**：平均值、期初期末值、趋势、峰值等
- **植被状况评级**：根据NDVI自动评级（优秀/良好/一般/较差）
- **监测期**：从数据时间范围自动计算

## 技术实现

### 文件结构

```
frontend/src/
├── components/
│   └── ReportTemplate.vue          # 报告模板组件
├── utils/
│   └── reportGenerator.js           # 报告数据生成工具
├── composables/
│   └── usePDFExport.js              # PDF导出功能（已增强）
└── views/
    └── ZoneDetail.vue               # 监测区详情页（已更新）
```

### 核心功能

1. **报告数据生成** (`reportGenerator.js`)
   - 从监测区数据和图表数据计算报告所需的所有指标
   - 自动获取当前碳价
   - 计算统计数据（平均值、趋势、峰值等）

2. **报告模板** (`ReportTemplate.vue`)
   - 使用Vue组件渲染报告HTML
   - 支持目录导航
   - 专业的表格和排版样式
   - 打印友好的CSS样式

3. **PDF导出** (`usePDFExport.js`)
   - 使用html2pdf.js库
   - 支持A4格式
   - 优化的页面分割和边距设置

## 注意事项

1. **数据要求**
   - 监测区必须有基本数据（名称、面积等）
   - 建议有监测数据以便生成完整的统计信息
   - 如果没有监测数据，报告仍会生成，但部分统计信息可能显示为默认值

2. **图片功能**
   - 当前版本中，报告模板中的图片占位符（边界图、NDVI趋势图）尚未实现
   - 这些功能可以在后续版本中添加
   - 不影响报告的基本功能

3. **性能**
   - 报告生成需要几秒钟时间
   - 如果数据量大，可能需要更长时间
   - 导出过程中请勿关闭页面

## 后续优化建议

1. **图表图片生成**
   - 使用ECharts的`getDataURL()`方法生成NDVI趋势图
   - 从地图组件截图生成监测区边界图

2. **报告预览**
   - 添加报告预览功能，在导出前可以查看报告内容

3. **报告模板定制**
   - 支持自定义报告模板
   - 支持添加公司Logo等

4. **批量导出**
   - 支持批量导出多个监测区的报告

## 问题排查

如果遇到导出失败：

1. 检查浏览器控制台是否有错误信息
2. 确保监测区数据已加载完成
3. 检查网络连接（需要获取碳价数据）
4. 尝试刷新页面后重试
